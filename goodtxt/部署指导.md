# GoodTxt 完整部署指导

## 🚀 快速开始

如果您想要立即体验修复后的GoodTxt系统，请按照以下步骤操作：

### 1. 克隆项目并初始化
```bash
# 克隆项目
git clone <repository-url>
cd goodtxt

# 初始化数据库（重要！）
python scripts/init_database.py
```

### 2. 快速启动
```bash
# 使用快速部署脚本
./quick_fix_deploy.sh

# 或者使用超级启动器
python3 super_launcher.py
```

### 3. 访问系统
- **前端地址**: http://localhost:5173
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs

### 4. 登录系统
- **默认账户**: admin / admin123456
- 或者注册新用户

## 📋 系统修复内容

### ✅ 已修复的核心问题

1. **前端API配置问题**
   - 创建了环境变量配置文件
   - 修复了硬编码API地址
   - 支持开发/生产环境自动切换

2. **用户数据持久化问题**
   - 实现了SQLite数据库存储
   - 用户注册后数据永久保存
   - 重启系统数据不会丢失

3. **API路由不匹配问题**
   - 添加了缺失的项目列表路由
   - 修复了前后端API调用不一致

4. **数据库初始化问题**
   - 创建了完整的数据库初始化脚本
   - 自动创建所有必要的表结构
   - 提供了数据库维护工具

5. **系统启动流程优化**
   - 提供了快速部署脚本
   - 完善了启动文档
   - 增强了错误处理

## 📁 新增文件说明

### 数据库相关
- `backend/database/init_db.py` - 数据库初始化脚本
- `backend/database/db_manager.py` - 数据库连接管理器
- `backend/database/__init__.py` - 数据库模块

### 配置管理
- `frontend/.env.development` - 开发环境配置
- `frontend/.env.production` - 生产环境配置

### 部署工具
- `scripts/init_database.py` - 数据库初始化工具
- `quick_fix_deploy.sh` - 快速部署脚本

### 文档
- `问题诊断与修复报告.md` - 详细问题分析
- `修复说明.md` - 部署指导
- `修复完成报告.md` - 修复总结
- `README.md` - 完整项目说明

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 数据库初始化失败
```bash
# 检查Python环境
python3 --version

# 手动初始化数据库
cd backend
python ../scripts/init_database.py

# 检查权限
chmod +x scripts/init_database.py
```

#### 2. 前端无法连接后端
```bash
# 确认后端服务启动
curl http://localhost:8000/health

# 检查API地址配置
cat frontend/.env.development

# 端口被占用
lsof -i :8000
kill -9 $(lsof -t -i:8000)
```

#### 3. 用户注册失败
```bash
# 检查数据库文件
ls -la data/database/

# 查看后端日志
tail -f logs/backend.log

# 手动检查数据库
sqlite3 data/database/goodtxt.db ".tables"
```

#### 4. Docker部署问题
```bash
# 清理Docker资源
docker system prune -a

# 重建镜像
docker-compose build --no-cache

# 查看详细错误
docker-compose up
```

## 🛠 技术架构

### 前端技术栈
- React 18 + TypeScript
- Vite 构建工具
- Tailwind CSS + shadcn/ui
- Axios HTTP客户端

### 后端技术栈
- FastAPI (Python 3.9+)
- SQLite 数据库
- JWT 认证
- 多AI模型集成

### 数据库设计
```sql
-- 核心数据表
users          -- 用户信息
projects       -- 小说项目
chapters       -- 章节内容
user_tokens    -- 用户令牌
system_logs    -- 系统日志
quality_reports -- 质量报告
memory         -- AI记忆
agent_performance -- 代理性能
```

## 📊 验证系统

运行以下命令验证系统是否正常工作：

```bash
# 1. 验证修复
python3 test_fixes.py

# 2. 检查服务状态
curl http://localhost:8000/health

# 3. 测试API
curl http://localhost:8000/docs

# 4. 验证数据库
sqlite3 data/database/goodtxt.db "SELECT COUNT(*) FROM users;"
```

## 🔑 默认管理员账户

系统启动后会自动创建：
- **用户名**: admin
- **密码**: admin123456

## 📞 获取帮助

如果您在使用过程中遇到问题：

1. **查看文档**: 参考 `README.md` 和 `修复说明.md`
2. **检查日志**: 查看 `logs/backend.log` 和 `logs/frontend.log`
3. **运行诊断**: 执行 `python3 super_launcher.py --check`
4. **重新初始化**: 运行 `python scripts/init_database.py`

## 🎯 预期效果

修复完成后，您将获得：

- ✅ 稳定的用户注册和登录功能
- ✅ 用户数据持久化保存
- ✅ 前后端API正确通信
- ✅ 完整的项目管理功能
- ✅ 可扩展的数据库架构
- ✅ 完善的错误处理机制

---

**版本**: v0.1.2  
**更新时间**: 2026-01-31  
**状态**: 完全可用  
